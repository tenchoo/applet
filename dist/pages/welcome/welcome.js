"use strict";var _api=require("../../config/api"),wxAPI=require("../../common/js/wxAPI"),app=getApp();Page({data:{},onLoad:function(n){},onReady:function(){},onShow:function(){this.login(this)},login:function(n){var e=this;wxAPI.login().then(function(t){if(t.code){var o=t.code;wxAPI.getSetting("scope.userInfo").then(function(t){t?n.getUserInfo(o,e,app):wxAPI.authorize("scope.userInfo").then(function(){wxAPI.getSetting("scope.userInfo").then(function(t){t&&n.getUserInfo(o,e,app)})})})}})},getUserInfo:function(n,e,t){wxAPI.getUserInfo(!0).then(function(e){return t.globalData.userInfo=e.userInfo,wxAPI.postRequest(_api.api.check_bind,{code:n})}).then(function(n){if(console.log(n),0===n.data.status){var e=n.data.data.accountRow;wx.setStorageSync("open_id",e.open_id),"1"===e.is_bind?(wx.setStorageSync("account_id",e.account_id),wx.switchTab({url:"../index/index"})):wx.redirectTo({url:"../signup/signup"})}})}});