"use strict";var _api=require("../../config/api"),wxAPI=require("../../common/js/wxAPI"),app=getApp();Page({data:{calendarWeek:["日","一","二","三","四","五","六"],modalBool:!1,pickerVal:[],pickerBool:!1},onLoad:function(t){},onReady:function(){},onShow:function(){this.calendar(this);var t=new Date,a=t.getFullYear(),e=t.getMonth()+1,n=[],o=[];this.setData({year:a,month:e});for(var s=2e3;s<=a+5;s++)n.push(s);for(var i=1;i<13;i++)o.push(i);this.setData({years:n,months:o}),this.setData({pickerVal:[n.indexOf(a),o.indexOf(e)]})},calendar:function(t){var a=new Date,e=a.getFullYear(),n=a.getMonth()+1;this.renderDay(this,e,n),t.setData({currentYear:e,currentMonth:n})},getThisMonthDays:function(t,a){return new Date(t,a,0).getDate()},getFirstDayOfWeek:function(t,a){return new Date(Date.UTC(t,a-1,1)).getDay()},getLastDayOfWeek:function(t,a,e){var n=t.getThisMonthDays(a,e);return new Date(Date.UTC(a,e-1,n)).getDay()},renderDay:function(t,a,e){var n=t.getFirstDayOfWeek(a,e),o=void 0;o=e<2?t.getThisMonthDays(a-1,11):t.getThisMonthDays(a,e-1);var s=[],i=[];if(n>0)for(var r=0;r<n;r++)s.unshift(o-r);var h=t.getLastDayOfWeek(t,a,e);if(h<6)for(var c=0;c<6-h;c++)i.push(c+1);var d=null;d=e<2?{account_id:wx.getStorageSync("account_id"),year:a-1,month:12}:{account_id:wx.getStorageSync("account_id"),year:a,month:e-1};var u={account_id:wx.getStorageSync("account_id"),year:a,month:e},D=null;D=e>11?{account_id:wx.getStorageSync("account_id"),year:a+1,month:1}:{account_id:wx.getStorageSync("account_id"),year:a,month:e+1},s.length>0?wxAPI.postRequest(_api.api.journey,d).then(function(a){if(0===a.data.status){for(var e=a.data.data,n=[],o=0;o<s.length;o++){var i=s[o]-1,r={ind:i+1,date:e[i].date,taskList:e[i].taskList};n.push(r)}t.setData({prevMonthData:n})}else console.log(a.data.msg)}):t.setData({prevMonthData:[]}),wxAPI.postRequest(_api.api.journey,u).then(function(a){if(0===a.data.status){var e=a.data.data;t.setData({monthData:e})}else console.log(a.data.msg)}),i.length>0?wxAPI.postRequest(_api.api.journey,D).then(function(a){if(0===a.data.status){for(var e=a.data.data,n=[],o=0;o<i.length;o++){var s={date:e[o].date,taskList:e[o].taskList};n.push(s)}t.setData({nextMonthData:n})}else console.log(a.data.msg)}):t.setData({nextMonthData:[]}),t.setData({prevMonthDays:s,nextMonthDays:i})},getPrevDayTask:function(t){if(t){var a=t.target.dataset.prev;this.getData(this,a,this.data.prevMonthData)}},getDayTask:function(t){if(t){var a=t.target.dataset.id;this.getData(this,a,this.data.monthData)}},getNextDayTask:function(t){if(t){var a=t.target.dataset.nex;this.getData(this,a,this.data.nextMonthData)}},getData:function(t,a,e){var n=e[a];if(n.taskList){var o=n.taskList;if(o.length){var s=new Date(n.date),i=s.getFullYear()+"年"+(s.getMonth()+1)+"月"+s.getDate()+"日";t.setData({selectDate:i,selectTaskList:o,modalBool:!0})}}},closeModal:function(){this.setData({modalBool:!1})},changeDate:function(t){var a=t.detail.value,e=this.data.years[a[0]],n=this.data.months[a[1]];this.setData({tempYear:e,tempMonth:n,tempYearIndex:a[0],tempMonthIndex:a[1]})},pickerSure:function(){this.renderDay(this,this.data.tempYear,this.data.tempMonth),this.setData({year:this.data.tempYear,month:this.data.tempMonth,pickerVal:[this.data.tempYearIndex,this.data.tempMonthIndex],pickerBool:!1})},pickerCancel:function(){this.setData({pickerBool:!1})},viewDataPicker:function(){this.data.pickerBool?this.setData({pickerBool:!1}):this.setData({pickerBool:!0})},onPullDownRefresh:function(){wx.stopPullDownRefresh()},onShareAppMessage:function(){}});